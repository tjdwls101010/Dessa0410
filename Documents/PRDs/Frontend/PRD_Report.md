# 프론트엔드 PRD: 분석 리포트 생성 및 조회

**버전:** 1.0
**기준 문서:** Documents/PRDs/PRD_Project.md, Documents/References/Overview.md

## 1. 개요 (Overview)

백엔드 API(`/submit_survey`)로부터 받은 설문 분석 결과(`analysis_result` JSON)를 바탕으로, 시각적이고 이해하기 쉬운 웹 리포트 페이지를 동적으로 생성하여 사용자에게 제공한다. 사용자는 이 리포트를 통해 자신의 통증 상태에 대한 예비 정보와 관련 병원 치료법 정보를 얻을 수 있다.

## 2. 목표 (Goals)

-   복잡한 분석 결과를 사용자가 쉽게 이해할 수 있도록 시각적으로 표현한다.
-   주요 분석 지표(Red Flag, 기능 제한, 통증 강도 등)를 명확하게 전달한다.
-   사용자의 응답을 반영한 개인화된 설명을 제공하여 공감대를 형성한다.
-   서비스의 비진단적 목적과 전문의 상담 필요성을 명확히 고지한다.
-   사용자가 리포트 내용을 저장(PDF)할 수 있는 기능을 제공한다.

## 3. 사용자 인터페이스 (UI) 및 경험 (UX)

-   **페이지 레이아웃:**
    -   **상단:** "자가 점검 결과 리포트" 제목, 생성 날짜, **"본 리포트는 의료 진단이 아니며, 참고용입니다. 정확한 진단 및 상담은 반드시 전문의와 상의하세요."** 경고 문구 명확히 표시.
    -   **본문 (섹션화):**
        -   **요약 섹션:** AI가 생성한 `report_summary_text` 표시. 주요 결과(예: 기능 제한 수준, 주요 통증 부위) 간략 언급.
        -   **Red Flag 징후 섹션:** `red_flags` 배열에 내용이 있을 경우, 눈에 띄는 경고 박스(붉은색 계열, 경고 아이콘)로 해당 내용 표시. "다음과 같은 징후가 발견되었습니다. 빠른 시일 내에 전문의와 상담하시기 바랍니다." 문구 포함. 내용이 없으면 "특별한 Red Flag 징후는 발견되지 않았습니다." 표시.
        -   **통증 상세 정보 섹션:**
            -   **통증 부위 시각화:** 인체 그림 위에 사용자가 선택한 통증 부위(`analysis_result` 내 관련 데이터 활용) 표시. (라이브러리: `react-body-highlighter` 또는 유사 SVG)
            -   **통증 강도/양상:** 평균 통증 강도(`pain_severity_avg`), 통증 양상(`pain_pattern`) 등을 텍스트, 아이콘, 간단한 그래프로 요약 표시.
            -   **통증 기간/빈도:** 관련 설문 응답 기반 정보 요약.
        -   **기능 제한 평가 섹션:**
            -   **기능 제한 점수:** 계산된 `functional_limit_score` 표시 (예: ODI/NDI 점수). 점수에 따른 심각도(경미, 중등도, 심각 등) 표시.
            -   **항목별 응답 시각화:** 기능 제한 관련 설문 항목(D항목) 응답을 막대 그래프, 레이더 차트 등으로 시각화하여 어떤 활동에서 어려움을 겪는지 보여줌. (라이브러리: `Recharts`, `Chart.js`)
        -   **잠재적 원인 및 관련 요인 섹션:** AI가 추론한 `potential_causes` (자세, 생활 습관 등) 리스트 또는 텍스트로 표시. "이는 추정이며, 정확한 원인은 검사를 통해 확인해야 합니다." 문구 포함.
        -   **추천 검사/치료법 섹션:** `recommended_services` 배열에 포함된 병원 치료법(예: "도수 치료", "슈로스 운동") 리스트 표시. 각 항목 클릭 시 해당 치료법에 대한 간단한 설명 팝업 또는 확장 패널 제공 (내용은 `Information_Hospital.md` 등 참고). "환자분의 상태에 적합할 수 있는 치료법이며, 최종 결정은 전문의와 상담 후 진행됩니다." 문구 포함.
        -   **개인화된 코멘트:** 사용자의 특정 응답(예: "오래 앉아있을 때 통증이 심해진다고 하셨는데...")을 인용하며 분석 결과나 조언을 제공하는 텍스트 영역 (AI 생성 텍스트 활용).
    -   **하단:** PDF 저장 버튼, 챗봇으로 질문하기 버튼/링크, **"다시 한번 강조하지만, 이 결과는 참고용이며 전문의 상담이 필수적입니다."** 문구 재강조.
-   **디자인:** `PRD_Project.md`의 UI/UX 고려사항 참조 (신뢰감, 전문성, 시각화 강조). 반응형 디자인 필수.

## 4. 기능 요구사항 (Functional Requirements)

-   **FR-REPORT-001:** 프론트엔드 상태 또는 URL 파라미터 등을 통해 전달받은 `analysis_result` JSON 데이터를 파싱하여 사용.
-   **FR-REPORT-002:** 리포트 상단에 비진단적 목적 및 전문의 상담 필수 문구 표시.
-   **FR-REPORT-003:** `analysis_result` 내 `red_flags` 유무에 따라 Red Flag 경고 섹션 조건부 렌더링.
-   **FR-REPORT-004:** 인체 그림 위에 사용자가 선택한 통증 부위 시각화 기능.
-   **FR-REPORT-005:** 기능 제한 점수 및 심각도 표시 기능.
-   **FR-REPORT-006:** 기능 제한 항목별 응답 차트 시각화 기능 (막대 그래프/레이더 차트 등).
-   **FR-REPORT-007:** 통증 강도, 양상, 기간 등 주요 지표 요약 표시 기능.
-   **FR-REPORT-008:** AI 분석 결과 (요약, 잠재 원인, 추천 치료법, 개인화 코멘트) 표시 기능.
-   **FR-REPORT-009:** 추천 치료법 클릭 시 설명 팝업/확장 패널 표시 기능.
-   **FR-REPORT-010:** 리포트 내용을 PDF 파일로 저장하는 기능 (클라이언트 측 `jsPDF`, `html2canvas` 활용).
-   **FR-REPORT-011:** 챗봇 페이지로 이동하는 버튼/링크 제공.
-   **FR-REPORT-012:** 리포트 하단에 비진단적 목적 및 전문의 상담 필수 문구 재표시.
-   **FR-REPORT-013:** 반응형 디자인 적용 (데스크탑, 모바일).

## 5. 데이터 흐름 (Data Flow)

1.  설문 완료 후, 설문 페이지에서 리포트 페이지로 이동하면서 `analysis_result` 데이터 전달 (예: React Context, Zustand/Jotai 상태, 또는 URL query parameter - 보안 고려 필요).
2.  리포트 페이지 컴포넌트는 전달받은 `analysis_result` 데이터를 사용하여 각 섹션 렌더링.
3.  시각화 컴포넌트(차트, 인체 그림)는 `analysis_result` 내 해당 데이터를 props로 받아 렌더링.
4.  'PDF 저장' 버튼 클릭 시, `html2canvas`로 리포트 영역을 이미지로 변환 후 `jsPDF`를 사용하여 PDF 생성 및 다운로드 트리거.
5.  '챗봇으로 질문하기' 버튼 클릭 시, 챗봇 페이지로 이동 (필요시 `analysis_result` 요약 정보 전달).

## 6. 기술 고려사항 (Technical Considerations)

-   **프레임워크:** Next.js (React) - 서버 컴포넌트/클라이언트 컴포넌트 적절히 활용.
-   **상태 관리:** (필요시) Zustand, Jotai 또는 React Context.
-   **시각화 라이브러리:**
    -   차트: `Recharts` 또는 `Chart.js`.
    -   인체 그림: `react-body-highlighter` 또는 커스텀 SVG.
-   **PDF 생성:** `jsPDF`, `html2canvas`.
-   **UI 라이브러리:** Shadcn/ui, Tailwind CSS 등 활용 고려.

## 7. 비기능 요구사항 (Non-Functional Requirements)

-   **성능:** 리포트 페이지 로딩 및 시각화 요소 렌더링 속도 최적화.
-   **접근성:** 스크린 리더 사용자를 고려한 시맨틱 마크업 및 ARIA 속성 사용. 차트 등 시각 정보에 대한 대체 텍스트 제공.
-   **보안:** URL 파라미터로 민감 데이터 전달 시 주의.
-   **호환성:** 주요 최신 웹 브라우저 호환.

## 8. 향후 개선 (Future Enhancements)

-   리포트 공유 기능 (고유 링크 생성 - `report_access_key` 활용).
-   사용자 피드백 수집 기능 (리포트 만족도 등).
-   과거 리포트 비교 기능 (사용자 계정 기능 구현 시).
