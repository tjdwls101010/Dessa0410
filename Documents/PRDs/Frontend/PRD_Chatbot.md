# 프론트엔드 PRD: RAG 기반 챗봇 인터페이스

**버전:** 1.0
**기준 문서:** Documents/PRDs/PRD_Project.md, Documents/References/Overview.md

## 1. 개요 (Overview)

사용자가 생성된 분석 리포트 내용 및 사전에 입력된 병원 Q&A 데이터를 기반으로 질문하고 답변을 받을 수 있는 웹 기반 챗봇 인터페이스를 개발한다. 사용자의 질문은 백엔드 API(`/chat`)로 전송되고, 백엔드에서 RAG(Retrieval-Augmented Generation) 및 LLM(Gemini)을 통해 생성된 답변을 받아 화면에 표시한다.

## 2. 목표 (Goals)

-   사용자가 리포트 내용이나 병원 정보에 대해 궁금한 점을 편리하게 질문할 수 있는 인터페이스를 제공한다.
-   백엔드로부터 받은 챗봇의 답변을 명확하게 표시한다.
-   챗봇의 역할(정보 제공 보조)과 한계(의료 진단 불가)를 사용자에게 명확히 인지시킨다.

## 3. 사용자 인터페이스 (UI) 및 경험 (UX)

-   **페이지 레이아웃:**
    -   **상단:** 챗봇 제목 (예: "온누리 AI 정보 챗봇"), **"본 챗봇은 의료 상담/진단을 제공하지 않으며, 정보 안내 목적으로만 사용됩니다."** 안내 문구 표시.
    -   **대화 내용 표시 영역:**
        -   사용자 질문과 챗봇 답변이 시간 순서대로 번갈아 표시되는 스크롤 가능한 영역.
        -   사용자 질문과 챗봇 답변을 시각적으로 구분 (예: 배경색, 정렬 방향).
        -   챗봇 답변에는 생성 중임을 나타내는 로딩 인디케이터 표시 기능 필요.
        -   초기 메시지로 챗봇의 역할과 사용법 안내 (예: "안녕하세요! 분석 리포트나 온누리마취통증의학과에 대해 궁금한 점을 질문해주세요.").
    -   **하단:**
        -   **텍스트 입력창:** 사용자가 질문을 입력하는 영역.
        -   **전송 버튼:** 입력된 질문을 백엔드로 전송하는 버튼. 엔터 키 입력으로도 전송 가능하도록 구현.
-   **컴포넌트 상세:**
    -   **메시지 버블:** 사용자 또는 챗봇의 메시지를 담는 컴포넌트. 발신자(user/bot)에 따라 스타일 구분.
    -   **텍스트 입력 필드:** 여러 줄 입력이 가능하도록 `textarea` 사용 고려. 입력 내용에 따라 높이 자동 조절 기능.
    -   **전송 버튼:** 아이콘 버튼 형태 고려. 입력 내용이 없을 경우 비활성화.
    -   **로딩 인디케이터:** 챗봇이 답변을 생성하는 동안 표시될 애니메이션 또는 텍스트 (예: "답변 생성 중...").
-   **디자인:** `PRD_Project.md`의 UI/UX 고려사항 참조 (표준적인 챗 인터페이스, 신뢰감). 반응형 디자인 필수.

## 4. 기능 요구사항 (Functional Requirements)

-   **FR-CHAT-001:** 챗봇 인터페이스 상단에 비진단적 목적 안내 문구 표시.
-   **FR-CHAT-002:** 사용자 질문 입력 및 '전송' 버튼(또는 Enter 키) 기능.
-   **FR-CHAT-003:** 전송 시, 입력된 질문 텍스트와 현재 사용자의 리포트 컨텍스트(`analysis_result` 요약 정보)를 포함하여 백엔드 API (`POST /chat`) 호출.
-   **FR-CHAT-004:** API 호출 중 로딩 인디케이터 표시.
-   **FR-CHAT-005:** 사용자 질문을 대화 내용 표시 영역에 추가.
-   **FR-CHAT-006:** 백엔드로부터 받은 챗봇 답변(`answer` 텍스트)을 대화 내용 표시 영역에 추가.
-   **FR-CHAT-007:** 대화 내용이 길어질 경우 스크롤 기능 제공 및 새 메시지 추가 시 자동으로 맨 아래로 스크롤.
-   **FR-CHAT-008:** API 호출 실패 시 사용자에게 오류 메시지 표시.
-   **FR-CHAT-009:** 반응형 디자인 적용 (데스크탑, 모바일).
-   **FR-CHAT-010:** (선택) 초기 추천 질문 버튼 제공 (예: "내 리포트 요약해줘", "도수치료가 뭔가요?").

## 5. 데이터 흐름 (Data Flow)

1.  사용자가 텍스트 입력창에 질문 입력 후 '전송' 버튼 클릭.
2.  프론트엔드는 입력된 질문 텍스트와 현재 세션의 `analysis_result`에서 필요한 컨텍스트 정보(예: `response_id`, 주요 결과 요약 등)를 추출하여 JSON 객체 생성.
    ```json
    // 예시 구조
    {
      "query": "사용자 질문 내용",
      "report_context": { // 리포트 페이지에서 전달받거나 상태에서 관리
        "response_id": "...", // 백엔드에서 리포트 데이터 조회용
        "summary": "...", // 간단 요약 정보
        "recommended_services": ["...", "..."]
        // 필요한 최소한의 컨텍스트 정보
      }
    }
    ```
3.  백엔드 API (`POST /chat`)에 해당 JSON을 Request Body로 전송.
4.  프론트엔드는 사용자 질문을 화면에 표시하고 로딩 인디케이터 표시.
5.  백엔드 응답 (성공 시 `{ "answer": "..." }`, 실패 시 `{ "detail": "..." }`) 수신.
6.  성공 시: 로딩 인디케이터 제거 후, 받은 `answer` 텍스트를 챗봇 메시지로 화면에 표시.
7.  실패 시: 로딩 인디케이터 제거 후, 오류 메시지 표시.

## 6. 기술 고려사항 (Technical Considerations)

-   **프레임워크:** Next.js (React)
-   **상태 관리:** Zustand, Jotai 또는 React Context (대화 기록, 로딩 상태, 리포트 컨텍스트 관리).
-   **HTTP 클라이언트:** `fetch` API 또는 `axios`.
-   **UI 라이브러리:** Shadcn/ui, Tailwind CSS 등 활용 고려.
-   **리포트 컨텍스트 전달:** 리포트 페이지에서 챗봇 페이지로 이동 시 `analysis_result`의 필요한 부분을 상태 관리 라이브러리나 Context API를 통해 전달.

## 7. 비기능 요구사항 (Non-Functional Requirements)

-   **성능:** 챗봇 응답 표시 지연 최소화 (백엔드 응답 속도에 의존적).
-   **사용성:** 직관적인 챗 인터페이스 제공.
-   **보안:** 민감 정보 클라이언트 측 노출 금지.
-   **호환성:** 주요 최신 웹 브라우저 호환.

## 8. 향후 개선 (Future Enhancements)

-   대화 기록 로컬 저장/복원 기능.
-   챗봇 답변에 대한 피드백(좋아요/싫어요) 기능.
-   답변 출처 명시 기능 (예: "병원 FAQ 기반", "리포트 내용 기반").
