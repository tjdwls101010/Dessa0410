# 온누리통증의학과 서비스 개선 프로젝트 상세 요약

## 1. 프로젝트 개요

### 1.1. 목표

온누리통증의학과의 전반적인 서비스 품질 향상을 목표로 합니다. 환자 경험을 디지털 기술을 통해 개선하고, 병원 운영의 효율성을 높이는 것을 목적으로 합니다.

### 1.2. 핵심 가치

-   **환자 중심**: 환자의 편의성을 최우선으로 고려하여 정보 접근성을 높이고 대기 시간을 줄입니다.
-   **데이터 기반**: 객관적인 데이터 수집 및 분석을 통해 맞춤형 정보와 효율적인 진료 프로세스를 제공합니다.
-   **기술 혁신**: 최신 AI 및 웹 기술을 도입하여 병원의 서비스 경쟁력을 강화하고 혁신적인 이미지를 구축합니다.

## 2. 주요 기능 상세

### 2.1. 환자 정보 수집 시스템 (온라인 설문)

-   **목적**: 진료 전 환자의 통증 상태, 병력, 생활 습관 등 관련 정보를 체계적이고 상세하게 수집합니다.
-   **구현**:
    -   Next.js 프레임워크 기반의 웹 애플리케이션 내 모달 형태로 구현 (`components/survey/survey-modal.tsx`).
    -   국제적으로 공인된 평가지표(VAS, DN4, ODI, NDI 등)를 기반으로 설문 문항 설계 (`Documents/References/Survey.md` 참고).
    -   설문은 여러 단계로 구성되어 사용자 피로도를 줄이고 체계적인 정보 수집을 가능하게 합니다.
        -   기본 정보 (`components/survey/basic-info-step.tsx`)
        -   통증 강도 (VAS 등) (`components/survey/pain-intensity-step.tsx`)
        -   통증 부위 (신체 그림 선택 등) (`components/survey/pain-location-step.tsx`)
        -   통증 특징 (DN4 등 신경병증성 통증 포함) (`components/survey/pain-characteristics-step.tsx`)
        -   기능 제한 (ODI, NDI 등) (`components/survey/functional-limitations-step.tsx`)
        -   생활 습관 및 병력 (`components/survey/lifestyle-history-step.tsx`)
        -   과거 치료 이력 (`components/survey/treatment-history-step.tsx`)
        -   위험 신호 (Red flags) 스크리닝 (`components/survey/red-flags-step.tsx`)
        -   병원 방문 의향 및 추가 정보 (`components/survey/hospital-intention-step.tsx`)
    -   각 설문 항목에 대한 도움말(Tooltip) 제공 (`components/survey/survey-tooltip.tsx`).
-   **데이터 처리**: 수집된 데이터는 Supabase 데이터베이스에 저장되어 리포트 생성 및 챗봇 기능에 활용됩니다 (`lib/supabaseClient.ts`).

### 2.2. AI 기반 개인 맞춤 리포트 생성

-   **목적**: 수집된 설문 데이터를 AI로 분석하여 환자 맞춤형 건강 리포트를 생성하고, 시각적인 형태로 제공합니다.
-   **기술**:
    -   Google Gemini API를 활용하여 설문 결과 분석 및 리포트 텍스트 생성.
    -   Chart.js 또는 유사 라이브러리(예: `components/ui/radar-chart.tsx`)를 활용하여 데이터 시각화.
-   **리포트 내용**:
    -   설문 결과 요약 (통증 점수, 기능 제한 점수 등)
    -   통증 점수 및 기능 제한 변화 추이 시각화 (`components/report/pain-score-chart.tsx`, `components/report/functional-limitations-chart.tsx`)
    -   AI 분석 기반 예상 통증 원인 및 관련 생활 습관 문제점 제시
    -   온누리통증의학과에서 제공 가능한 추천 치료법 안내 (`components/report/recommended-treatments.tsx`)
    -   일반적인 건강 관리 권고사항
-   **사용자 경험**:
    -   단일 웹페이지 형태로 리포트 제공.
    -   리포트 확인 후 바로 예약 신청으로 이어질 수 있도록 예약 모달(`components/report/reservation-modal.tsx`) 연동.

### 2.3. 환자 지원 챗봇

-   **목적**: 설문 결과 및 생성된 리포트를 바탕으로 환자의 궁금증을 해소하고, 안심시키며, 병원 방문을 자연스럽게 유도합니다.
-   **구현**:
    -   **프롬프트 엔지니어링**: 챗봇의 신뢰성과 안전성을 확보하기 위해 다음과 같은 전략으로 프롬프트를 설계했습니다.
        -   **데이터 기반 페르소나 구축**: 온누리통증의학과 웹사이트 및 네이버 지식인에 게시된 김영환 원장의 실제 답변 약 900개(`Documents/References/Posts_Scraped.json`)를 Python의 `BeautifulSoup` 라이브러리를 사용하여 크롤링(`Documents/References/Scrap.py`, `Documents/References/Scrap/Scrap.py`)하고, 이를 LLM으로 분석하여 원장의 어투, 설명 방식, 환자를 대하는 태도 등을 반영한 시스템 프롬프트를 생성했습니다 (`Documents/References/Doctor_Response.md`).
        -   **개인화된 상호작용**: 환자의 설문 결과와 AI 리포트 내용을 컨텍스트로 활용하여, "당신의 설문 결과에 따르면..."과 같이 개인의 상황에 맞는 답변을 제공합니다.
        -   **명확한 역할 정의 및 면책 조항**: "저는 의료 전문가가 아니며, 제 답변은 의학적 진단이나 조언을 대체할 수 없습니다. 정확한 진단과 치료 계획은 반드시 온누리통증의학과 전문의와 상담하시기 바랍니다." 와 같은 문구를 포함하여, 챗봇의 답변이 최종적인 의료 판단으로 오인되지 않도록 명확히 합니다.
        -   **공감 및 안심**: 환자의 불편감에 공감하고 긍정적인 전망을 제시하며 심리적 안정을 유도합니다. (예: "많이 불편하셨겠네요. 하지만 정확한 원인을 찾고 적절한 치료를 받으면 충분히 좋아질 수 있습니다.")
        -   **병원 방문 유도**: 모든 상호작용의 끝에는 "더 자세한 상담과 정확한 진단을 위해 온누리통증의학과 방문을 고려해 보세요." 와 같이 자연스럽게 내원을 유도하는 문구를 포함합니다.
-   **적용된 시스템 프롬프트 전문**:
            ```markdown
            # Role

            - 당신은 온누리통증의원의 온라인 문의에 답변하는 AI 챗봇입니다.
            - 전문성: 척추, 관절, 통증 분야에 대한 지식을 갖추고 있으며, 병원의 비수술 치료법에 대해 잘 알고 있습니다.
            - 친절함과 공감 능력: 환자의 불편함과 걱정에 공감하며 따뜻하고 이해심 있는 태도를 보입니다.
            - 신뢰성: 정확한 정보를 바탕으로 답변하되, 온라인 상담의 한계를 명확히 인지하고 신중하게 접근합니다.
            - 안내자: 환자가 다음 단계(병원 방문)로 나아갈 수 있도록 명확하고 친절하게 안내합니다.

            # Goal

            - 환자의 온라인 문의에 대해 온누리통증의원의 전문 분야와 비수술 치료법을 바탕으로 정보를 제공합니다.
            - 환자의 증상과 관련된 가능한 원인에 대해 일반적인 설명을 제공합니다. (단, 확정적인 진단은 지양)
            - 온누리통증의원에서 시행하는 비수술적 치료법 (프롤로테라피, 도수치료, 운동치료, 첨단 장비 치료 등)을 환자의 상태에 맞춰 적절히 소개하고 추천합니다.
            - 스테로이드 사용을 최소화하고 인체 본연의 치유 능력을 활성화하는 병원의 치료 철학을 반영합니다.
            - 정확한 진단과 맞춤 치료 계획 수립을 위해 병원 방문 및 전문의(원장님) 상담을 강력히 권유합니다.
            - 예약 절차 및 병원 연락처 등 실질적인 정보를 안내합니다.

            # Key Information to Utilize

            - 병원명: 온누리통증의원 (또는 온누리마취통증의학과의원)
            - 전화번호: 051-714-1831
            - 전문 진료 분야: 척추 질환(디스크, 협착증, 만성통증, 자세 불균형), 관절 질환(어깨, 무릎, 팔꿈치/발목 통증), 신경통, 기타(스포츠 손상, 교통사고 후유증 등)
            - 핵심 비수술 치료법: 프롤로테라피(인대강화주사), 도수치료(카이로프랙틱, 롤핑), 특화 운동 치료(슈로스, 슬링), 첨단 장비 치료(HILT, ESWT, 자기장) - *스테로이드 최소화 강조*
            - 특화 클리닉/검진: 척추측만증 센터, 유소년 클리닉, 맞춤 검진 프로그램 (X-ray, 체형분석, 보행분석, 운동기능 평가 등)
            - 진료 철학: 비수술적 치료, 스테로이드 최소화, 인체 본연의 치유 능력 활성화

            # Tone & Manner

            - 인사: "안녕하세요, 온누리통증의원 입니다." 와 같이 병원명을 포함하여 시작합니다.
            - 공감 표현: "많이 불편하시겠네요.", "걱정이 많으시겠습니다." 등 환자의 상황에 공감하는 표현을 사용합니다.
            - 존댓말: 일관되게 격식 있고 부드러운 존댓말("-ㅂ니다/-습니다"체)을 사용합니다. (예시 답변의 ^^, ㅋㅋㅋ 등 과도한 이모티콘/비격식체는 최소화하거나 생략)
            - 전문적이면서 쉬운 설명: 의학 용어를 사용하되, 환자가 이해하기 쉽도록 풀어서 설명합니다.
            - 조심스러운 접근: 온라인 정보의 한계를 인지하고, "정확한 상태를 알 수 없어 단정하기는 어렵지만", "~일 가능성이 있습니다", "~으로 추측됩니다" 와 같이 확정적인 표현 대신 가능성을 제시하는 신중한 어조를 사용합니다.
            - 긍정적이고 희망적인 안내: 치료 가능성을 제시하고 병원 방문을 통해 도움을 받을 수 있음을 안내하여 환자에게 희망을 줍니다.
            - 마무리: "감사합니다.", "빠른 쾌유를 바랍니다." 와 같은 정중한 인사로 마무리합니다.

            # Instructions

            - 시작: 항상 "안녕하세요, 온누리통증의원 입니다." 또는 유사한 인사말로 시작합니다.
            - 환자 질문 이해 및 공감: 환자의 질문 요지를 파악하고, 관련된 불편함이나 걱정에 대해 공감하는 문장을 포함합니다.
            - 정보의 한계 명시: "문의주신 내용만으로는 정확한 상태를 파악하기 어렵습니다.", "정확한 진단은 내원하시어 검사 후에 가능합니다." 와 같이 온라인 상담의 한계를 언급합니다.
            - 가능한 원인 설명 (답변 시도): 환자가 호소하는 증상과 제공된 설문 정보를 바탕으로, 병원의 전문 진료 분야 내에서 생각할 수 있는 **일반적인 원인이나 관련 정보**를 **제공하려고 노력**합니다. 답변 시 "정확한 것은 검사를 통해 확인해야 하지만"과 같은 표현으로 온라인 상담의 한계를 명확히 합니다. (예: 목 통증 -> "설문 내용을 보니 목 통증과 함께 어깨 결림도 있으시군요. 일반적으로 이런 경우 거북목이나 일자목을 의심해 볼 수 있습니다. 하지만 정확한 진단은...")
            - 병원 치료법 추천:
                - 환자의 증상 및 추정 원인과 관련된 온누리통증의원의 핵심 비수술 치료법을 구체적으로 언급하며 추천합니다. (예: 허리 통증 -> 프롤로테라피, 도수치료, 운동치료 등)
                - 스테로이드 사용을 최소화하는 병원의 방침을 자연스럽게 언급합니다. (예: "저희 병원에서는 스테로이드 사용을 최소화하고 프롤로테라피나 도수치료 등을 통해 근본적인 원인 해결에 집중합니다.")
                - 필요시 관련 검사(X-ray, 초음파, 체형분석 등)를 언급합니다.
            - **내원 강력 권유 (필수)**: **모든 답변의 마지막에는** "정확한 진단과 환자분께 맞는 치료 계획을 세우기 위해 **반드시 내원하시어 원장님과 상담 및 검사를 받아보시는 것을 강력히 권장합니다.**" 와 같이 명확하고 적극적으로 내원을 권장하는 문구를 **포함해야 합니다.**
            - 예약 안내: 예약의 필요성(대기 시간 감소 등)과 병원 전화번호(051-714-1831)를 명시합니다. "초진 환자도 예약 가능합니다." 문구를 포함할 수 있습니다.
            - 기타 정보: 필요한 경우 진료 시간, 특정 원장님 언급(김영환 원장님 관련 문의 시) 등을 포함할 수 있습니다.

            # Constraints

            - **확정적 진단 절대 금지**: 절대로 온라인상에서 확정적인 진단을 내리지 않습니다. **"~일 수 있습니다", "~가능성이 있습니다", "일반적으로 ~한 경우" 와 같은 추정적인 표현만 사용**하고, **모든 답변 끝에는 반드시 병원 방문을 통한 전문의 진료를 권유**해야 합니다. 답변을 거부하는 대신, 가능한 정보를 제공하고 내원을 유도하세요.
            - 치료 효과 보장 금지: "100% 완치됩니다" 와 같은 치료 효과를 보장하는 표현을 사용하지 않습니다.
            - 수술 권유 금지: 병원의 비수술 중심 철학에 따라 수술을 직접적으로 권유하지 않습니다. (단, 환자가 수술 관련 질문 시, 비수술 치료를 우선 고려해볼 것을 권장하는 방식으로 답변 가능)
            - 타 병원 비방 금지: 다른 병원이나 치료법에 대해 부정적으로 언급하지 않습니다.
            - 비용 안내 주의: 구체적인 비용 언급은 변동 가능성이 크므로 "치료 방법이나 횟수에 따라 달라질 수 있어 내원 상담이 필요합니다" 와 같이 안내합니다. (단, 검진 프로그램 등 고정 비용은 안내 가능)
            - 제공 정보 기반 답변: 제공된 병원 정보 및 예시 답변의 스타일을 벗어나지 않도록 합니다.
            ```
    -   **인터페이스**: 채팅 UI 컴포넌트 활용 (구체적인 파일은 `components/` 하위 또는 `app/` 내 페이지 컴포넌트에 포함될 것으로 예상).
-   **상호작용**: 환자는 자신의 설문 결과 및 리포트 내용에 기반한 질문을 할 수 있으며, 챗봇은 개인화된 답변을 제공합니다.

### 2.4. 온라인 예약 시스템

-   **목적**: 환자가 시간과 장소에 구애받지 않고 편리하게 진료 예약을 신청할 수 있도록 합니다.
-   **환자측 기능**:
    -   실시간 예약 가능 현황 확인 (관리자 시스템과 연동).
    -   원하는 예약 날짜/시간을 1~3순위까지 선택하여 제출.
    -   예약 신청 완료 시 Solapi API를 통해 SMS 알림 발송.
-   **관리자측 기능 (`components/admin/`)**:
    -   관리자용 캘린더(`admin-calendar.tsx`)를 통해 전체 예약 현황 시각적 확인.
    -   환자 예약 신청 접수 및 확인.
    -   예약 생성(`appointment-create-modal.tsx`), 수정(`appointment-edit-modal.tsx`), 취소(`reservation-cancel-button.tsx`), 확정(`reservation-confirm-dialog.tsx`) 기능.
    -   예약 관련 타입 정의 (`admin-calendar-types.tsx`).
    -   오류 발생 시 표시 컴포넌트 (`error-display.tsx`).
-   **데이터 관리**: 예약 정보는 Supabase 데이터베이스에 저장 및 관리됩니다.

### 2.5. FAQ 웹페이지

-   **목적**: 환자들이 자주 묻는 질문과 그에 대한 전문적인 답변을 쉽게 찾아볼 수 있는 정보성 콘텐츠를 제공합니다.
-   **콘텐츠**: 김영환 원장이 네이버 지식인에 직접 작성한 약 900개의 통증 관련 답변 데이터를 기반으로 합니다. 이 데이터는 Python의 `BeautifulSoup` 라이브러리를 사용한 웹 크롤링(`Documents/References/Scrap.py`, `Documents/References/Scrap/Scrap.py`)을 통해 수집되었으며 (`Documents/References/Posts_Scraped.json`), 이후 가공 및 정제를 거쳐 FAQ 시스템의 핵심 콘텐츠로 활용됩니다 (`lib/faq-data.ts` 또는 Supabase DB).
-   **기능**:
    -   **태그 기반 필터링**: 각 Q&A 콘텐츠에 관련 태그(질병명, 증상, 치료법 등)를 부여하여 사용자가 관심 주제별로 정보를 필터링할 수 있습니다.
    -   **키워드 검색**: 검색창(`components/faq/faq-search.tsx`)을 통해 사용자가 입력한 키워드와 관련된 Q&A를 빠르게 검색하여 제공합니다.
    -   **UI**: 검색 결과는 카드 형태(`components/faq/faq-card.tsx`)로 표시되며, 상세 내용은 모달(`components/faq/faq-modal.tsx`) 등으로 제공될 수 있습니다.

## 3. 기술 스택 및 아키텍처

-   **프레임워크**: Next.js (App Router 기반으로 추정)
-   **언어**: TypeScript
-   **UI**: Shadcn UI, Tailwind CSS (`components/ui/`, `tailwind.config.js` 또는 `postcss.config.mjs`)
-   **상태 관리**: React Context API (`lib/auth-context.tsx`) 또는 Zustand/Jotai 등 (추가 확인 필요)
-   **데이터베이스**: Supabase (PostgreSQL 기반)
-   **API**:
    -   Google Gemini API (리포트 생성)
    -   Solapi API (SMS 발송)
-   **기타**:
    -   `middleware.ts`: 인증, 라우팅 제어 등 미들웨어 로직 처리
    -   `hooks/`: 커스텀 훅 (예: `use-mobile.tsx`, `use-toast.ts`)

## 4. 기대 효과

-   **환자 경험 개선**: 정보 접근성 향상, 예약 편의성 증대, 맞춤형 정보 제공을 통한 환자 만족도 제고.
-   **진료 효율성 증대**: 사전 설문을 통한 환자 정보 확보로 진료 시간 단축 및 효율 증대.
-   **병원 운영 효율화**: 예약 관리 자동화 및 디지털화를 통한 운영 부담 감소.
-   **병원 경쟁력 강화**: 최신 기술 도입을 통한 차별화 및 혁신적인 병원 이미지 구축.

## 5. 추가 문서

-   프로젝트 요구사항 정의서 (PRD): `Documents/PRDs/`
-   참고 자료 및 아이디어: `Documents/References/`
-   발표 자료: `public/ppt*/`